---
sidebar_label: Troubleshooting
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import TabsWrapper from '@site/src/components/TabsWrapper';

# Troubleshooting Security Issues

This guide helps you diagnose and fix common security-related issues with the MLflow tracking server.

## Common Error Messages

### 403 Invalid Host Header

**Error**: `403 Forbidden - Invalid Host header - possible DNS rebinding attack detected`

**Symptom**: Clients receive a 403 error when trying to access the MLflow server

#### Diagnosis Steps

1. **Check what Host header is being sent**:

   ```bash
   curl -v http://your-server:5000/health 2>&1 | grep "Host:"
   ```

2. **Test with specific Host header**:

   ```bash
   curl -H "Host: mlflow.company.com" http://192.168.1.100:5000/health
   ```

3. **Check server logs**:
   ```bash
   # Look for rejected Host headers in server output
   mlflow server --dev  # Enable debug logging
   ```

#### Solutions

Each solution below addresses a different aspect of the Host header validation issue. Start with adding the specific host that's being rejected, and only use wildcards if you're in a development environment. The Python SDK fix shows how to ensure your code uses the correct hostname:

<TabsWrapper>
<Tabs>
<TabItem value="add-host" label="Add to Allowed Hosts" default>

```bash
# Add the hostname being used by clients
export MLFLOW_ALLOWED_HOSTS="mlflow.company.com,192.168.1.100:5000"
mlflow server --host 0.0.0.0
```

</TabItem>
<TabItem value="wildcard" label="Allow All (Development)">

```bash
# For development only - allows any Host header
export MLFLOW_ALLOWED_HOSTS="*"
mlflow server --host 0.0.0.0
```

</TabItem>
<TabItem value="python" label="Python SDK Fix">

```python
import mlflow

# Use the exact hostname/IP that's in allowed-hosts
mlflow.set_tracking_uri("http://mlflow.company.com:5000")
# Not: mlflow.set_tracking_uri("http://192.168.1.100:5000")
```

</TabItem>
</Tabs>
</TabsWrapper>

### Cross-Origin Request Blocked

**Error**: `Cross-origin request blocked: The Same Origin Policy disallows reading the remote resource`

**Symptom**: Web applications can't access the MLflow API

#### Diagnosis Steps

1. **Check browser console** for the exact origin being blocked
2. **Verify current CORS configuration**:
   ```bash
   curl -H "Origin: https://app.company.com" \
        -H "Access-Control-Request-Method: POST" \
        -v http://mlflow-server:5000/api/2.0/mlflow/experiments/search
   ```

#### Solutions

The following solutions address different CORS configuration scenarios. Choose the most specific configuration that meets your needs - avoid using wildcards unless you're in a controlled development environment:

<TabsWrapper>
<Tabs>
<TabItem value="add-origin" label="Add Specific Origin" default>

```bash
# Add the blocked origin
export MLFLOW_CORS_ALLOWED_ORIGINS="https://app.company.com,https://notebook.company.com"
mlflow server --host 0.0.0.0
```

</TabItem>
<TabItem value="pattern" label="Use Pattern">

```bash
# Allow all subdomains
export MLFLOW_CORS_ALLOWED_ORIGINS="https://*.company.com"
mlflow server --host 0.0.0.0
```

</TabItem>
<TabItem value="preflight" label="Debug Preflight">

Test preflight requests:

```bash
# Send OPTIONS request like browser does
curl -X OPTIONS \
     -H "Origin: https://app.company.com" \
     -H "Access-Control-Request-Method: POST" \
     -H "Access-Control-Request-Headers: Content-Type" \
     -v http://mlflow-server:5000/api/2.0/mlflow/experiments/search
```

</TabItem>
</Tabs>
</TabsWrapper>

### Refused to Display in Frame

**Error**: `Refused to display 'http://mlflow:5000' in a frame because it set 'X-Frame-Options' to 'SAMEORIGIN'`

**Symptom**: Cannot embed MLflow UI in iframe

#### Solutions

These solutions provide different approaches to enable iframe embedding. The first option removes all restrictions (use carefully), while the second provides fine-grained control through a reverse proxy:

<TabsWrapper>
<Tabs>
<TabItem value="disable" label="Disable Restriction" default>

```bash
# Allow embedding from any origin
export MLFLOW_X_FRAME_OPTIONS="NONE"
mlflow server --host 0.0.0.0
```

</TabItem>
<TabItem value="proxy" label="Via Reverse Proxy">

```nginx
# nginx configuration
location / {
    proxy_pass http://localhost:5000;

    # Remove MLflow's header
    proxy_hide_header X-Frame-Options;

    # Add your own control
    add_header X-Frame-Options "ALLOW-FROM https://app.company.com";
}
```

</TabItem>
</Tabs>
</TabsWrapper>

## Access Issues

### Can Ping But Get 403 Error

**Problem**: Network connectivity works but MLflow returns 403

This usually means:

- ✅ Network connectivity is fine (`--host` is correct)
- ❌ Host header validation is failing (`--allowed-hosts` issue)

**Solution**:

```python
# In Python, check what Host header is being used
import mlflow
import logging

logging.basicConfig(level=logging.DEBUG)
mlflow.set_tracking_uri("http://your-server:5000")

# The debug logs will show the exact Host header being sent
```

### Works Locally But Not Remotely

**Common causes**:

1. Server still bound to localhost
2. Firewall blocking the port
3. Security configuration rejecting remote hosts

**Diagnostic steps**:

```bash
# 1. Check server binding
netstat -an | grep 5000
# Should show 0.0.0.0:5000, not 127.0.0.1:5000

# 2. Test from remote machine
telnet mlflow-server 5000

# 3. Test with curl from remote
curl -v http://mlflow-server:5000/health
```

### Authentication Errors

MLflow doesn't have built-in token authentication. If you see auth errors:

1. **Using MLflow Auth**: Check username/password environment variables
2. **Using Proxy Auth**: Verify proxy credentials
3. **Custom Auth**: Check your reverse proxy configuration

## Notebook-Specific Issues

### Traces Show as Text Instead of UI

**Problem**: MLflow traces display as plain text in Jupyter notebooks

**Diagnosis**:

```python
import mlflow
from mlflow.utils.uri import is_http_uri

# Must be using tracking server for UI display
print(f"Using tracking server: {is_http_uri(mlflow.get_tracking_uri())}")
# Should print: True

# Check if display is working
trace = mlflow.get_trace("your-trace-id")
print(type(trace._repr_mimebundle_()))  # Should be dict, not str
```

**Solutions**:

1. **Ensure using tracking server**:

   ```python
   mlflow.set_tracking_uri("http://mlflow-server:5000")
   ```

2. **Configure for cross-origin notebooks**:
   ```bash
   export MLFLOW_X_FRAME_OPTIONS="NONE"
   export MLFLOW_CORS_ALLOWED_ORIGINS="https://notebook.company.com"
   ```

### iframe Works Locally But Not in Production

**Common causes**:

1. HTTPS/HTTP mismatch (mixed content)
2. Missing production origins in configuration
3. Reverse proxy stripping headers

**Solutions**:

```bash
# Production configuration
export MLFLOW_X_FRAME_OPTIONS="NONE"
export MLFLOW_CORS_ALLOWED_ORIGINS="https://app.company.com"
export MLFLOW_ALLOWED_HOSTS="mlflow.company.com"

# If behind proxy, ensure headers are preserved
mlflow server --host 127.0.0.1
```

## Debugging Tools

### Enable Debug Logging

```bash
# Show detailed security decisions
mlflow server --dev --host 0.0.0.0
```

### Test Security Headers

```bash
# Check what headers are returned
curl -I http://mlflow-server:5000/

# Should see:
# X-Content-Type-Options: nosniff
# X-Frame-Options: SAMEORIGIN (or your configured value)
```

### Browser Developer Tools

1. **Network Tab**: Check request/response headers
2. **Console**: Look for CORS or CSP errors
3. **Security Tab**: Review security policies

### Test Different Scenarios

```bash
# Test host validation
curl -H "Host: evil.com" http://your-server:5000/health
# Should return 403

# Test CORS
curl -H "Origin: http://evil.com" \
     -X POST http://your-server:5000/api/2.0/mlflow/experiments/create
# Should return 403

# Test allowed origin
curl -H "Origin: https://app.company.com" \
     http://your-server:5000/api/2.0/mlflow/experiments/search
# Should succeed
```

## Migration Issues

### Upgrading from Pre-3.5.0

If your setup worked before MLflow 3.5.0 but fails now:

1. **Local development**: Should work without changes
2. **Production**: May need to configure allowed origins:
   ```bash
   export MLFLOW_CORS_ALLOWED_ORIGINS="https://your-apps.com"
   export MLFLOW_ALLOWED_HOSTS="mlflow.yourdomain.com"
   ```

### Moving from Insecure Configuration

If you were using development settings in production:

**Old (insecure)**:

```bash
mlflow server --host 0.0.0.0  # No security
```

**New (secure)**:

```bash
export MLFLOW_ALLOWED_HOSTS="mlflow.company.com"
export MLFLOW_CORS_ALLOWED_ORIGINS="https://app.company.com"
mlflow server --host 0.0.0.0
```

## Performance Issues

### Security Middleware Overhead

The security middleware has minimal performance impact, but if needed:

```bash
# Disable if you have alternative security
export MLFLOW_DISABLE_SECURITY_MIDDLEWARE="true"
mlflow server --host 127.0.0.1  # Only behind trusted proxy
```

## Getting Help

If you're still having issues:

1. **Enable debug logging**: `mlflow server --dev`
2. **Collect information**:
   - Exact error message
   - MLflow version: `mlflow --version`
   - Configuration used
   - Browser console errors
3. **File an issue**: [GitHub Issues](https://github.com/mlflow/mlflow/issues)
4. **Join the community**: [MLflow Slack](https://mlflow.org/slack)

## Quick Reference

| Error                     | Likely Cause                    | Quick Fix                            |
| ------------------------- | ------------------------------- | ------------------------------------ |
| 403 Invalid Host          | Host header not in allowed list | Add to `MLFLOW_ALLOWED_HOSTS`        |
| CORS blocked              | Origin not allowed              | Add to `MLFLOW_CORS_ALLOWED_ORIGINS` |
| iframe refused            | X-Frame-Options blocking        | Set `MLFLOW_X_FRAME_OPTIONS="NONE"`  |
| Works locally, not remote | Bound to localhost              | Use `--host 0.0.0.0`                 |
| Traces show as text       | Not using tracking server       | Set `mlflow.set_tracking_uri()`      |

## Next Steps

- [Security Best Practices](/ml/tracking/server/security/best-practices)
- [Configuration Reference](/ml/tracking/server/security/configuration)
- [UI Access Guide](/ml/tracking/server/security/ui-access)
